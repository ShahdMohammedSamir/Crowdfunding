{% extends 'base.html' %}
{% block title %}Register - Crowdfunding Platform{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="auth-container shadow-lg rounded-4 overflow-hidden">
      <!-- Header with gradient background matching navbar -->
      <div class="auth-header text-white text-center py-4" style="background: linear-gradient(135deg, #4CAF50 0%, #2196F3 100%);">
        <h2 class="mb-1"><i class="fas fa-user-plus me-2"></i>Join Our Community</h2>
        <p class="mb-0 opacity-75">Create your crowdfunding account</p>
      </div>

      <div class="auth-body bg-white p-5">
        <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
          {% csrf_token %}

          {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {% for error in form.non_field_errors %}
                {{ error }}
              {% endfor %}
            </div>
          {% endif %}

          <!-- Two-column layout for name fields -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="{{ form.first_name.id_for_label }}" class="form-label fw-semibold text-dark">
                <i class="fas fa-user me-2" style="color: #4CAF50;"></i>First Name
              </label>
              {{ form.first_name }}
              {% for error in form.first_name.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
              <label for="{{ form.last_name.id_for_label }}" class="form-label fw-semibold text-dark">
                Last Name
              </label>
              {{ form.last_name }}
              {% for error in form.last_name.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>
          </div>

          <!-- Email Field -->
          <div class="mb-3">
            <label for="{{ form.email.id_for_label }}" class="form-label fw-semibold text-dark">
              <i class="fas fa-envelope me-2" style="color: #4CAF50;"></i>Email Address
            </label>
            {{ form.email }}
            {% for error in form.email.errors %}
              <div class="invalid-feedback d-block">{{ error }}</div>
            {% endfor %}
          </div>

          <!-- Password Fields -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="{{ form.password1.id_for_label }}" class="form-label fw-semibold text-dark">
                <i class="fas fa-lock me-2" style="color: #4CAF50;"></i>Password
              </label>
              <div class="input-group">
                {{ form.password1 }}
                <button type="button" class="btn btn-outline-secondary border-start-0" onclick="togglePassword('{{ form.password1.id_for_label }}')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              {% for error in form.password1.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
              <label for="{{ form.password2.id_for_label }}" class="form-label fw-semibold text-dark">
                Confirm Password
              </label>
              <div class="input-group">
                {{ form.password2 }}
                <button type="button" class="btn btn-outline-secondary border-start-0" onclick="togglePassword('{{ form.password2.id_for_label }}')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              {% for error in form.password2.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>
          </div>

          <!-- Mobile Phone -->
          <div class="mb-3">
            <label for="{{ form.mobile_phone.id_for_label }}" class="form-label fw-semibold text-dark">
              <i class="fas fa-phone me-2" style="color: #4CAF50;"></i>Mobile Phone
            </label>
            {{ form.mobile_phone }}
            {% for error in form.mobile_phone.errors %}
              <div class="invalid-feedback d-block">{{ error }}</div>
            {% endfor %}
            <div class="form-text">Egyptian phone number (11 digits starting with 010, 011, 012, or 015)</div>
          </div>

          <!-- Optional Fields -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="{{ form.birthdate.id_for_label }}" class="form-label fw-semibold text-dark">
                <i class="fas fa-birthday-cake me-2" style="color: #4CAF50;"></i>Birthdate
              </label>
              {{ form.birthdate }}
            </div>
            <div class="col-md-6 mb-3">
              <label for="{{ form.country.id_for_label }}" class="form-label fw-semibold text-dark">
                <i class="fas fa-globe me-2" style="color: #4CAF50;"></i>Country
              </label>
              {{ form.country }}
            </div>
          </div>

          <!-- Profile Picture Upload -->
          <div class="mb-4 text-center">
            <label for="profile_picture" class="file-label btn btn-outline-primary px-4" style="border-color: #4CAF50; color: #4CAF50;">
              <i class="fas fa-camera me-2"></i> Choose Profile Photo
            </label>
            <input type="file" name="profile_picture" id="profile_picture" class="d-none" accept="image/*" onchange="previewFile(event)">
            
            <div class="mt-3">
              <img id="preview" alt="Profile Preview" class="img-thumbnail rounded-circle shadow" 
                   style="width: 150px; height: 150px; object-fit: cover; display: none;">
            </div>
            <div id="fileName" class="text-muted mt-2 small"></div>
          </div>

          <!-- Register Button -->
          <button type="submit" class="btn btn-primary btn-lg w-100 py-3 fw-bold" style="background: linear-gradient(135deg, #4CAF50 0%, #2196F3 100%); border: none;">
            <i class="fas fa-user-plus me-2"></i> Create Account
          </button>
        </form>

        <!-- Login Link -->
        <div class="text-center mt-4 pt-3 border-top">
          <p class="text-muted mb-2">Already have an account?</p>
          <a href="{% url 'login' %}" class="btn btn-outline-success px-4" style="border-color: #4CAF50; color: #4CAF50;">
            <i class="fas fa-sign-in-alt me-2"></i> Sign In
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .auth-container {
    border: 1px solid #e9ecef;
    margin: 2rem 0;
  }
  
  .auth-header {
    border-radius: 0.5rem 0.5rem 0 0;
  }
  
  .form-control {
    border: 2px solid #dee2e6;
    padding: 12px 16px;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  .form-control:focus {
    border-color: #4CAF50;
    box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25);
  }
  
  .btn-primary {
    transition: all 0.3s ease;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
  }
  
  .btn-outline-success {
    transition: all 0.3s ease;
  }
  
  .btn-outline-success:hover {
    background-color: #4CAF50;
    color: white;
    transform: translateY(-1px);
  }
  
  .file-label {
    border: 2px dashed #4CAF50;
    padding: 12px 24px;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  .file-label:hover {
    background-color: rgba(76, 175, 80, 0.1);
    transform: translateY(-1px);
  }
  
  .input-group .form-control {
    border-right: none;
  }
  
  .input-group .btn {
    border-left: none;
    border-color: #dee2e6;
  }
  
  /* Match the navbar gradient colors */
  .gradient-bg {
    background: linear-gradient(135deg, #4CAF50 0%, #2196F3 100%);
  }
  
  .text-gradient {
    background: linear-gradient(135deg, #4CAF50 0%, #2196F3 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
</style>

<script>
  // Password visibility toggle
  function togglePassword(inputId) {
    const passwordInput = document.getElementById(inputId);
    const toggleButton = document.querySelector(`button[onclick="togglePassword('${inputId}')"] i`);
    
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      toggleButton.classList.remove('fa-eye');
      toggleButton.classList.add('fa-eye-slash');
    } else {
      passwordInput.type = 'password';
      toggleButton.classList.remove('fa-eye-slash');
      toggleButton.classList.add('fa-eye');
    }
  }
  
  // File preview
  function previewFile(event) {
    const preview = document.getElementById('preview');
    const fileName = document.getElementById('fileName');
    const file = event.target.files[0];
    
    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";
      fileName.textContent = file.name;
    }
  }
  
  // Add Bootstrap styling to form fields
  document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      if (!input.classList.contains('form-control')) {
        input.classList.add('form-control');
      }
    });
  });
  
  // Form validation
  (function () {
    'use strict'
    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>
{% endblock %}